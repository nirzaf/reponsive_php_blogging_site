!function(t,e,n,i){"use strict";function a(e,n){var i=this.element=t(e),a=this.elementOptions(i),l=a.activator||e;a.activator=t(l);var c=t.extend({},t.fn[o].defaults,n,a);this.opts=c,this.bindElement(c)}var o="jinplace",l=["type","url","data","loadurl","elementId","object","attribute","okButton","cancelButton","inputClass","activator","textOnly","placeholder","submitFunction"];a.prototype={elementOptions:function(e){function n(t){return"-"+t.toLowerCase()}function i(t){return"data-"+t.replace(/[A-Z]/g,n)}var a={};return t.each(l,function(t,n){a[n]=e.attr(i(n))}),a.elementId=e.attr("id"),a.textOnly&&(a.textOnly="false"!==a.textOnly),a},bindElement:function(e){e.activator.off("click.jip").on("click.jip",t.proxy(this.clickHandler,this));var n=this.element;""==t.trim(n.html())&&(n.html(e.placeholder),e.placeholder=n.html())},clickHandler:function(e){e.preventDefault(),e.stopPropagation(),t(e.currentTarget).off("click.jip").on("click.jip",function(t){t.preventDefault()});var n=this,a=n.opts,l=t.extend({},s,t.fn[o].editors[a.type]);n.origValue=n.element.html(),n.fetchData(a).done(function(t){var e=l.makeField(n.element,t);l.inputField||(l.inputField=e),e.addClass(a.inputClass);var o=r(a,e,l.buttonsAllowed);n.element.html(o),o.on("jip:submit submit",function(){return n.submit(l,a),!1}).on("jip:cancel",function(){return n.cancel(l),!1}).on("keyup",function(t){27==t.keyCode&&n.cancel(l)}),l.activate(o,e);var c=l.blurAction||(a.okButton?a.cancelButton?i:"jip:cancel":"submit");l.blurEvent(e,o,c)})},fetchData:function(e){var n;n=e.data?e.data:e.loadurl?e.loadFunction(e):e.textOnly?t.trim(this.element.text()):t.trim(this.element.html().replace(/&amp;/gi,"&"));var i=function(t){return t==e.placeholder?"":t},a=t.when(n);return a.pipe?a.pipe(i):a.then(i)},cancel:function(t){var e=this;e.element.html(e.origValue),t.finish(),e.bindElement(e.opts)},submit:function(e,n){var a,o=this,l=t.Deferred().reject();try{a=n.submitFunction.call(i,n,e.value()),a===i&&(a=l)}catch(c){a=l}t.when(a).done(function(t,i,a){o.element.trigger("jinplace:done",[t,i,a]),o.onUpdate(e,n,t)}).fail(function(t,n,i){o.element.trigger("jinplace:fail",[t,n,i]),o.cancel(e)}).always(function(t,e,n){o.element.trigger("jinplace:always",[t,e,n])})},onUpdate:function(t,e,n){var i=this;i.setContent(n),t.finish(),i.bindElement(e)},setContent:function(t){var e=this.element;return t?void(this.opts.textOnly?e.text(t):e.html(t)):void e.html(this.opts.placeholder)}};var c=function(e,n){var a={id:e.elementId,object:e.object,attribute:e.attribute};return t.isPlainObject(n)?t.extend(a,n):n!==i&&(a.value=n),a};t.fn[o]=function(e){return this.each(function(){t.data(this,"plugin_"+o)||t.data(this,"plugin_"+o,new a(this,e))})},t.fn[o].defaults={url:n.location.pathname,type:"input",textOnly:!0,placeholder:"[ --- ]",submitFunction:function(e,n){return t.ajax(e.url,{type:"post",data:c(e,n),dataType:"text",headers:{"Cache-Control":"no-cache"}})},loadFunction:function(e){return t.ajax(e.loadurl,{data:c(e)})}};var r=function(e,n,i){var a=t("<form>").attr("style","display: inline;").attr("action","javascript:void(0);").append(n);return i&&u(a,e),a},u=function(e,n){var i=function(t,n){e.append(t),t.one("click",function(t){t.stopPropagation(),e.trigger(n)})},a=n.okButton;if(a){var o=t("<input>").attr("type","button").attr("value",a).addClass("jip-button jip-ok-button");i(o,"submit")}var l=n.cancelButton;l&&(o=t("<input>").attr("type","button").attr("value",l).addClass("jip-button jip-cancel-button"),i(o,"jip:cancel"))},s={makeField:function(e,n){return t("<input>").attr("type","text").val(n)},activate:function(t,e){e.focus()},value:function(){return this.inputField.val()},blurEvent:function(t,e,n){if(n&&"ignore"!=n){var i=function(){var i=setTimeout(function(){t.trigger(n)},300);e.on("click",function(){clearTimeout(i)})};t.on("blur",i)}},finish:function(){}};t.fn[o].editorBase=s,t.fn[o].editors={input:{buttonsAllowed:!0},textarea:{buttonsAllowed:!0,makeField:function(e,n){return t("<textarea>").css({"min-width":e.width(),"min-height":e.height()}).val(n)},activate:function(t,e){e.focus(),e.elastic&&e.elastic()}},select:{makeField:function(e,n){var i=t("<select>"),a=t.parseJSON(n),o=!1,l=null;return t.each(a,function(n,a){var c=t("<option>").val(a[0]).html(a[1]);a[2]&&(c.attr("selected","1"),o=!0),a[1]==e.text()&&(l=c),i.append(c)}),!o&&l&&l.attr("selected","1"),i},activate:function(t,e){e.focus(),e.on("change",function(){e.trigger("jip:submit")})}}}}(jQuery,window,document);